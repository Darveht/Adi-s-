<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>VideoFlix</title>
    <!-- Se cambió la referencia a Font Awesome para usar una copia local.
         Asegúrate de descargar el archivo y colocarlo en la carpeta "css" -->
    <link rel="stylesheet" href="css/font-awesome.min.css">
    <style>
        :root {
            --primary: #e50914;
            --dark: #141414;
            --light: #f5f5f5;
            --gray: #808080;
        }
        
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Arial', sans-serif;
        }
        
        body {
            background-color: var(--dark);
            color: var(--light);
            overflow-x: hidden;
        }
        
        .navbar {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 1rem 5%;
            background-color: rgba(0, 0, 0, 0.8);
            position: fixed;
            top: 0;
            width: 100%;
            z-index: 1000;
        }
        
        .logo {
            color: var(--primary);
            font-size: 1.8rem;
            font-weight: bold;
        }
        
        .nav-links {
            display: flex;
            gap: 1.5rem;
        }
        
        .nav-links a {
            color: var(--light);
            text-decoration: none;
            font-size: 0.9rem;
        }
        
        .nav-links a:hover {
            color: var(--gray);
        }
        
        .user-actions {
            display: flex;
            align-items: center;
            gap: 1.5rem;
        }
        
        .search-icon, .user-profile {
            font-size: 1.2rem;
            cursor: pointer;
        }
        
        .search-icon:hover, .user-profile:hover {
            color: var(--gray);
        }
        
        .main-content {
            margin-top: 80px;
            padding: 0 5%;
        }
        
        .category-title {
            font-size: 1.5rem;
            margin: 1.5rem 0;
        }
        
        .video-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));
            gap: 1rem;
            margin-bottom: 2rem;
        }
        
        .video-card {
            background-color: #1a1a1a;
            border-radius: 4px;
            overflow: hidden;
            transition: transform 0.3s;
            cursor: pointer;
            position: relative;
        }
        
        .video-card:hover {
            transform: scale(1.05);
        }
        
        .thumbnail-container {
            position: relative;
            width: 100%;
            height: 0;
            padding-bottom: 56.25%; /* 16:9 Aspect Ratio */
            background-color: #000;
            overflow: hidden;
        }
        
        .thumbnail {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            object-fit: cover;
        }
        
        .video-preview {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            object-fit: cover;
            display: none;
        }
        
        .video-card:hover .video-preview {
            display: block;
        }
        
        .video-duration {
            position: absolute;
            bottom: 5px;
            right: 5px;
            background-color: rgba(0, 0, 0, 0.7);
            color: var(--light);
            padding: 2px 4px;
            border-radius: 2px;
            font-size: 0.7rem;
        }
        
        .video-info {
            padding: 0.8rem;
        }
        
        .video-title {
            font-size: 1rem;
            margin-bottom: 0.5rem;
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
        }
        
        .video-player {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.9);
            display: none;
            z-index: 2000;
            flex-direction: column;
        }
        
        .player-content {
            position: relative;
            width: 100%;
            height: 100%;
            display: flex;
            justify-content: center;
            align-items: center;
        }
        
        video {
            max-height: 90vh;
            max-width: 90%;
        }
        
        .video-controls {
            position: absolute;
            bottom: 20px;
            left: 50%;
            transform: translateX(-50%);
            width: 80%;
            background-color: rgba(0, 0, 0, 0.7);
            padding: 0.8rem;
            border-radius: 30px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        
        .control-left, .control-center, .control-right {
            display: flex;
            align-items: center;
            gap: 1rem;
        }
        
        .control-icon {
            color: var(--light);
            font-size: 1.2rem;
            cursor: pointer;
        }
        
        .control-icon:hover {
            color: var(--primary);
        }
        
        .progress-container {
            flex-grow: 1;
            height: 5px;
            background-color: rgba(255, 255, 255, 0.3);
            border-radius: 5px;
            margin: 0 1rem;
            cursor: pointer;
        }
        
        .progress-bar {
            height: 100%;
            background-color: var(--primary);
            border-radius: 5px;
            width: 0;
        }
        
        .close-player {
            position: absolute;
            top: 20px;
            right: 20px;
            background: none;
            border: none;
            color: var(--light);
            font-size: 1.5rem;
            cursor: pointer;
        }
        
        .upload-btn {
            position: fixed;
            bottom: 20px;
            right: 20px;
            background-color: var(--primary);
            color: var(--light);
            width: 60px;
            height: 60px;
            border-radius: 50%;
            display: flex;
            justify-content: center;
            align-items: center;
            font-size: 1.5rem;
            cursor: pointer;
            box-shadow: 0 4px 15px rgba(229, 9, 20, 0.5);
            z-index: 100;
        }
        
        .upload-btn:hover {
            transform: scale(1.1);
        }
        
        .hidden-upload {
            position: absolute;
            width: 100%;
            height: 100%;
            opacity: 0;
            cursor: pointer;
        }
        
        .tiktok-feed {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: var(--dark);
            z-index: 1500;
            overflow-y: hidden;
        }
        
        .tiktok-video {
            position: relative;
            width: 100%;
            height: 100vh;
            display: flex;
            justify-content: center;
            align-items: center;
        }
        
        .tiktok-video video {
            max-height: 85vh;
            max-width: 100%;
        }
        
        .video-actions {
            position: absolute;
            right: 20px;
            bottom: 150px;
            display: flex;
            flex-direction: column;
            gap: 1.5rem;
        }
        
        .action-icon {
            display: flex;
            flex-direction: column;
            align-items: center;
            color: var(--light);
            font-size: 1.8rem;
            cursor: pointer;
        }
        
        .swipe-indicator {
            position: absolute;
            bottom: 20px;
            left: 50%;
            transform: translateX(-50%);
            color: var(--light);
            font-size: 0.8rem;
            opacity: 0.8;
        }
        
        .empty-state {
            padding: 2rem;
            text-align: center;
            background-color: rgba(0, 0, 0, 0.3);
            border-radius: 8px;
            margin: 2rem 0;
        }
        
        .empty-state i {
            font-size: 3rem;
            color: var(--gray);
            margin-bottom: 1rem;
        }
        
        .empty-state h3 {
            margin-bottom: 0.5rem;
        }
        
        .empty-state p {
            color: var(--gray);
        }
        
        @media (max-width: 768px) {
            .video-grid {
                grid-template-columns: repeat(auto-fill, minmax(150px, 1fr));
            }
            
            .nav-links {
                display: none;
            }
        }
    </style>
</head>
<body>
    <!-- Navbar -->
    <div class="navbar">
        <div class="logo">VideoFlix</div>
        <div class="nav-links">
            <a href="#" class="active">Inicio</a>
            <a href="#">Mis Videos</a>
            <a href="#">Favoritos</a>
        </div>
        <div class="user-actions">
            <div class="user-profile">
                <i class="fas fa-user-circle"></i>
            </div>
        </div>
    </div>
    
    <!-- Main Content -->
    <div class="main-content">
        <h2 class="category-title">Mis Videos</h2>
        <div id="my-videos">
            <div class="empty-state" id="empty-state">
                <i class="fas fa-film"></i>
                <h3>No hay videos disponibles</h3>
                <p>Sube tus primeros videos usando el botón "+" abajo</p>
            </div>
            <div class="video-grid" id="videos-container"></div>
        </div>
    </div>
    
    <!-- Video Player (Netflix Style) -->
    <div class="video-player" id="video-player">
        <button class="close-player" id="close-player">
            <i class="fas fa-times"></i>
        </button>
        <div class="player-content">
            <video id="current-video" onclick="togglePlayPause()">
                <source src="" type="video/mp4">
            </video>
            <div class="video-controls">
                <div class="control-left">
                    <div class="control-icon" onclick="togglePlayPause()">
                        <i class="fas fa-play" id="play-icon"></i>
                    </div>
                    <div class="control-icon" onclick="toggleMute()">
                        <i class="fas fa-volume-up" id="volume-icon"></i>
                    </div>
                </div>
                <div class="control-center">
                    <div class="progress-container" id="progress-container">
                        <div class="progress-bar" id="progress-bar"></div>
                    </div>
                </div>
                <div class="control-right">
                    <div class="control-icon">
                        <i class="fas fa-expand"></i>
                    </div>
                </div>
            </div>
        </div>
    </div>
    
    <!-- TikTok Style Feed -->
    <div class="tiktok-feed" id="tiktok-feed">
        <div class="tiktok-video">
            <video id="tiktok-current-video" loop onclick="toggleTikTokPlayPause()">
                <source src="" type="video/mp4">
            </video>
            
            <div class="video-actions">
                <div class="action-icon" onclick="toggleLike()">
                    <i class="far fa-heart" id="like-icon"></i>
                </div>
                <div class="action-icon" onclick="toggleMuteTikTok()">
                    <i class="fas fa-volume-up" id="tiktok-volume-icon"></i>
                </div>
            </div>
            
            <div class="swipe-indicator">
                <i class="fas fa-chevron-up"></i> Desliza para el siguiente video
            </div>
        </div>
    </div>
    
    <!-- Upload Button (Simplificado) -->
    <div class="upload-btn" id="upload-btn">
        <i class="fas fa-plus"></i>
        <input type="file" accept="video/*" class="hidden-upload" id="video-upload" multiple>
    </div>
    
    <!-- Registro del Service Worker para funcionalidad offline -->
    <script>
        if ('serviceWorker' in navigator) {
            window.addEventListener('load', () => {
                navigator.serviceWorker.register('/sw.js')
                    .then(registration => {
                        console.log('Service Worker registrado con éxito:', registration);
                    })
                    .catch(error => {
                        console.log('Error al registrar el Service Worker:', error);
                    });
            });
        }
    </script>
    
    <script>
        // Referencias a elementos DOM
        const videoPlayer = document.getElementById('video-player');
        const currentVideo = document.getElementById('current-video');
        const tiktokFeed = document.getElementById('tiktok-feed');
        const tiktokCurrentVideo = document.getElementById('tiktok-current-video');
        const videosContainer = document.getElementById('videos-container');
        const emptyState = document.getElementById('empty-state');
        const videoUpload = document.getElementById('video-upload');
        const progressBar = document.getElementById('progress-bar');
        const progressContainer = document.getElementById('progress-container');
        const playIcon = document.getElementById('play-icon');
        const volumeIcon = document.getElementById('volume-icon');
        const tiktokVolumeIcon = document.getElementById('tiktok-volume-icon');
        const likeIcon = document.getElementById('like-icon');
        
        // Estado
        let isPlaying = false;
        let isMuted = false;
        let isTikTokMuted = false;
        let isLiked = false;
        let userVideos = [];
        let currentVideoIndex = 0;
        
        // Cargar videos del almacenamiento local al iniciar
        function loadVideosFromStorage() {
            const storedVideos = localStorage.getItem('userVideos');
            if (storedVideos) {
                userVideos = JSON.parse(storedVideos);
                renderVideos();
            }
        }
        
        // Guardar videos en almacenamiento local
        function saveVideosToStorage() {
            localStorage.setItem('userVideos', JSON.stringify(userVideos));
        }
        
        // Renderizar videos en la interfaz
        function renderVideos() {
            videosContainer.innerHTML = '';
            
            if (userVideos.length === 0) {
                emptyState.style.display = 'block';
                return;
            }
            
            emptyState.style.display = 'none';
            
            userVideos.forEach((video, index) => {
                const videoCard = document.createElement('div');
                videoCard.className = 'video-card';
                
                // Crear un elemento video para la miniatura
                const videoPreview = document.createElement('video');
                videoPreview.src = video.src;
                videoPreview.muted = true;
                videoPreview.className = 'video-preview';
                videoPreview.preload = 'metadata';
                
                // Evento para reproducir en hover
                videoCard.addEventListener('mouseenter', () => {
                    videoPreview.currentTime = 1; // Comenzar un poco después del inicio
                    videoPreview.play();
                });
                
                videoCard.addEventListener('mouseleave', () => {
                    videoPreview.pause();
                });
                
                videoCard.innerHTML = `
                    <div class="thumbnail-container">
                        <img src="/api/placeholder/300/169" alt="Miniatura de video" class="thumbnail">
                        <span class="video-duration">${formatDuration(video.duration || 0)}</span>
                    </div>
                    <div class="video-info">
                        <h3 class="video-title">${video.name || `Video ${index + 1}`}</h3>
                    </div>
                `;
                
                // Insertar el elemento de video después de la miniatura
                videoCard.querySelector('.thumbnail-container').appendChild(videoPreview);
                
                // Abrir el video al hacer clic
                videoCard.addEventListener('click', () => {
                    openVideo(index);
                });
                
                videosContainer.appendChild(videoCard);
            });
        }
        
        // Dar formato a la duración del video
        function formatDuration(seconds) {
            const minutes = Math.floor(seconds / 60);
            const remainingSeconds = Math.floor(seconds % 60);
            return `${minutes}:${remainingSeconds < 10 ? '0' : ''}${remainingSeconds}`;
        }
        
        // Abrir video en reproductor
        function openVideo(index) {
            currentVideoIndex = index;
            const video = userVideos[index];
            
            // Decidir aleatoriamente si abrir en modo Netflix o TikTok
            const useNetflixStyle = Math.random() > 0.5;
            
            if (useNetflixStyle) {
                // Modo Netflix
                currentVideo.src = video.src;
                videoPlayer.style.display = 'flex';
                currentVideo.load();
                playVideo();
                updateProgressBar();
            } else {
                // Modo TikTok
                tiktokCurrentVideo.src = video.src;
                tiktokFeed.style.display = 'block';
                tiktokCurrentVideo.load();
                tiktokCurrentVideo.play();
            }
        }
        
        // Manejar la subida de videos
        videoUpload.addEventListener('change', function(e) {
            if (this.files.length === 0) return;
            
            // Procesar cada archivo
            Array.from(this.files).forEach(file => {
                // Crear URL para el archivo
                const videoURL = URL.createObjectURL(file);
                
                // Obtener la duración del video
                const tempVideo = document.createElement('video');
                tempVideo.src = videoURL;
                
                tempVideo.onloadedmetadata = function() {
                    // Crear objeto de video
                    const videoObj = {
                        name: file.name.replace(/\.[^/.]+$/, ""),
                        src: videoURL,
                        duration: tempVideo.duration,
                        date: new Date().toISOString(),
                        liked: false,
                        id: Date.now() + Math.random().toString(36).substr(2, 9)
                    };
                    
                    // Añadir a la lista y guardar
                    userVideos.push(videoObj);
                    saveVideosToStorage();
                    renderVideos();
                };
            });
            
            // Resetear input para permitir seleccionar el mismo archivo nuevamente
            this.value = '';
        });
        
        // Función para reproducir video
        function playVideo() {
            currentVideo.play();
            playIcon.className = 'fas fa-pause';
            isPlaying = true;
        }
        
        // Función para pausar video
        function pauseVideo() {
            currentVideo.pause();
            playIcon.className = 'fas fa-play';
            isPlaying = false;
        }
        
        // Alternar reproducción/pausa
        function togglePlayPause() {
            if (isPlaying) {
                pauseVideo();
            } else {
                playVideo();
            }
        }
        
        // Alternar reproducción/pausa en modo TikTok
        function toggleTikTokPlayPause() {
            if (tiktokCurrentVideo.paused) {
                tiktokCurrentVideo.play();
            } else {
                tiktokCurrentVideo.pause();
            }
        }
        
        // Alternar mute
        function toggleMute() {
            currentVideo.muted = !currentVideo.muted;
            volumeIcon.className = currentVideo.muted ? 'fas fa-volume-mute' : 'fas fa-volume-up';
            isMuted = currentVideo.muted;
        }
        
        // Alternar mute en modo TikTok
        function toggleMuteTikTok() {
            tiktokCurrentVideo.muted = !tiktokCurrentVideo.muted;
            tiktokVolumeIcon.className = tiktokCurrentVideo.muted ? 'fas fa-volume-mute' : 'fas fa-volume-up';
            isTikTokMuted = tiktokCurrentVideo.muted;
        }
        
        // Alternar me gusta
        function toggleLike() {
            isLiked = !isLiked;
            likeIcon.className = isLiked ? 'fas fa-heart' : 'far fa-heart';
            
            // Guardar el estado de me gusta
            if (currentVideoIndex >= 0 && currentVideoIndex < userVideos.length) {
                userVideos[currentVideoIndex].liked = isLiked;
                saveVideosToStorage();
            }
        }
        
        // Actualizar barra de progreso
        function updateProgressBar() {
            currentVideo.addEventListener('timeupdate', () => {
                const progress = (currentVideo.currentTime / currentVideo.duration) * 100;
                progressBar.style.width = `${progress}%`;
            });
            
            progressContainer.addEventListener('click', (e) => {
                const progressWidth = progressContainer.clientWidth;
                const clickPosition = e.offsetX;
                const seekTime = (clickPosition / progressWidth) * currentVideo.duration;
                currentVideo.currentTime = seekTime;
            });
        }
        
        // Cerrar reproductor de video
        function closePlayer() {
            videoPlayer.style.display = 'none';
            pauseVideo();
        }
        
        // Cerrar feed de TikTok
        function closeTikTokFeed() {
            tiktokFeed.style.display = 'none';
            tiktokCurrentVideo.pause();
        }
        
        // Event Listeners
        document.getElementById('close-player').addEventListener('click', closePlayer);
        
        // Cerrar reproductores con escape
        document.addEventListener('keydown', (e) => {
            if (e.key === 'Escape') {
                closePlayer();
                closeTikTokFeed();
            }
        });
        
        // Soporte para swipe para videos de TikTok
        let startY = 0;
        tiktokFeed.addEventListener('touchstart', (e) => {
            startY = e.touches[0].clientY;
        });
        
        tiktokFeed.addEventListener('touchend', (e) => {
            const diffY = e.changedTouches[0].clientY - startY;
            if (Math.abs(diffY) > 100) {
                if (diffY > 0) {
                    // Swipe hacia abajo - cerrar feed
                    closeTikTokFeed();
                } else {
                    // Swipe hacia arriba - siguiente video
                    const nextIndex = (currentVideoIndex + 1) % userVideos.length;
                    if (nextIndex !== currentVideoIndex) {
                        openVideo(nextIndex);
                    }
                }
            }
        });
        
        tiktokFeed.addEventListener('click', (e) => {
            if (e.target === tiktokFeed) {
                closeTikTokFeed();
            }
        });
        
        // Cargar videos al iniciar
        window.addEventListener('DOMContentLoaded', loadVideosFromStorage);
    </script>
</body>
</html>
